{% extends "layout.html" %}
{% block title %}/u/{{user.name}} | Throat: Open discussion{% endblock %}
{% block navbar %}
<ul class="right">
  <li><a href="{{url_for('view_user', user=user.name)}}">{{user.name}}</a></li>
</ul>
{% endblock %}

{% block sidebar %}
{{ super() }}
<hr/>
<div class="row buttons">
  {% if user.uid == session['user_id'] %}
  <div class="col-12">
    <a href="#edit-user-form" class="btn btn-blue edit-user" style="width:100%;">Edit user info</a>
  </div>
  {% endif %}
  <div class="col-12">
    <a href="#msg-form" class="btn btn-blue send-message" style="width:100%;">Send a Message to {{user.name}}</a>
  </div>
</div>
<div>
  <h3>Badges:</h3>
  <ul style="color: darkcyan;">
    <li><i class="fa fa-bug" aria-hidden="true"></i> Bug squasher</li>
    {# for badges in user #}
      <!--<li><img src="{{url_for('static', filename='img/textpost.png')}}" alt="{# badge.name #}"/></li>-->
    {# endfor #}
  </ul>
  <hr>
  <p class="joindate">Registered <time-ago datetime="{{ user.joindate.isoformat() }}"></time-ago></p>
</div>
{% endblock %}

{% block content %}
{{ super() }}
  <h1 class="noshit">{{user.name}}</h1>
    <div class="user-activity col-10">
      <div class="recent">
        <h3>Recent Posts</h3>
        <ul class="rpost">
        {% for post in user.posts[::-1][:5] %}
          <li>
            <a class="title" href="{{url_for('view_post', sub=post.sub.name, pid=post.pid)}}">{{ post.title }}</a>
            <br>
            <a href="{{url_for('view_sub', sub=post.sub.name)}}" class="btn small">
              <i class="fa fa-users" aria-hidden="true"></i> /s/{{post.sub.name}}
            </a>
            <a href="{{url_for('view_post', sub=sub, pid=post.pid)}}" class="btn small">
              <i class="fa fa-comment" aria-hidden="true"></i> Comments
            </a>
            <span class="time btn small">
              <i class="fa fa-clock-o" aria-hidden="true"></i> Posted <time-ago datetime="{{post.posted.isoformat()}}"></time-ago>
            </span>
          </li>
        {% endfor %}
        </ul>
      </div>
      <div class="recent">
        <h3>Recent Comments</h3>
        <ul class="rpost">
          {% for comments in user.comments[::-1][:5] %}
          <li>
            <a class="title" href="{{ url_for('view_post', sub=comments.post.sub.name, pid=comments.post.pid) }}">{{comments.post.title}}</a>
            <br>
            <span class="comment">
              {{comments.content}}
            </span>
            <br>
            <a href="{{ url_for('view_sub', sub=comments.post.sub.name) }}" class="btn small">
              <i class="fa fa-users" aria-hidden="true"></i> /s/{{comments.post.sub.name}}
            </a>
            <a href="{{ url_for('view_post', sub=comments.post.sub.name, pid=comments.post.pid) }}" class="btn small">
              <i class="fa fa-comment" aria-hidden="true"></i> Comments
            </a>
            <span class="time btn small">
              <i class="fa fa-clock-o" aria-hidden="true"></i> Posted <time-ago datetime="{{comments.post.posted.isoformat()}}"></time-ago>
            </span>
          </li>
        {% endfor %}
        </ul>
      </div>
    </div>
    <div class="image col-2">
      <a href="#"><img src="{{url_for('static', filename='img/textpost.png')}}" alt="User Img"/></a>
    </div>

<form id="msg-form" data-user="{{user.uid}}" class="mfp-hide white-popup-block">
  {{msgform.csrf_token}}
  <h1>Submit a user message</h1>
  <p class="subject">{{msgform.subject(placeholder=msgform.subject.label.text, required=True, autofocus=True)}}</p>
  <p class="content">{{msgform.content(placeholder="Write your message content here. Styling with Markdown format is supported.")}}</p>
  <div class="alert div-error">
    <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
    <p></p>
  </div>
  <p><button type="submit" id="msg-btnsubmit">Send Message</button></p>
</form>
<!-- edit user form -->
{% if user.uid == session['user_id'] %}
<form id="edit-user-form"  data-user="{{user.name}}" class="mfp-hide white-popup-block">
    <div id="the-edit-user-form-itself">
        {{edituserform.csrf_token}}
        <h1>Edit info for {{user.name}}</h1>
        <p>{{edituserform.email(placeholder=edituserform.email.label.text)}}</p>
        <p>
            {{edituserform.accept_tos(style="width: auto", required=True)}}
            <label for="tos">{{edituserform.accept_tos.label.text}}</label>
        </p>
        {{edituserform.recaptcha}}
        <div class="alert div-error">
          <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
          <p></p>
        </div>
        <p><button type="submit" id="edituser-btnsubmit">Edit user</button></p>
    </div>
</form>
{% endif %}

<script type="text/javascript" src="{{ url_for('static', filename='js/simplemde.min.js') }}"></script>
<script>
  var simplemde = new SimpleMDE({autoDownloadFontAwesome: false, spellChecker: false, autosave: {enabled: true, unique_id: "sendmsg",}});
</script>

{% endblock %}
