{% extends "layout.html" %}
{% block head %}
{{ super() }}
{% endblock %}
{% block title %}Throat: Open discussion{% endblock %}
{% block sidebar %}
{{ super() }}
{% if current_user.is_authenticated %}
<div class="row buttons">
  <div class="col-12">
    <a href="#csub-form" class="btn btn-orange create-sub" style="width:100%;">Create your own sub</a>
  </div>
  <div class="col-12">
    <a href="{{url_for('view_subs')}}" class="btn btn-orange" style="width:100%;">View all subs</a>
  </div>
</div>
{% endif %}
{% endblock %}
{% block content %}
{{ super() }}

{% if not posts %}<h1 class="noshit">There are no posts here, yet.</h1>{% endif %}

{% for post in posts if not getMetadata(post, 'deleted') %}
    <article class="post" data-pid="{{post.pid}}">
      {# vote arrow div #}
      <div class="pull left vote">
        <div class="upvote{%if hasVoted(current_user.get_id(), post)%} upvoted{%endif%}"><i class="fa fa-chevron-up" aria-hidden="true"></i></div>
        <p class="count">{{post.voteCount}}</p>
        <div class="downvote{%if hasVoted(current_user.get_id(), post, False)%} downvoted{%endif%}"><i class="fa fa-chevron-down" aria-hidden="true"></i></div>
      </div>
      <div class="image">
        {% if not post.link %}
        <button type="button" class="lightbtn" id="text-post-icon">
          <a href="{{url_for('view_post', sub=post.sub.name, pid=post.pid)}}">
            <span class="fa-stack fa-3x" style="color: #616161;">
              <i class="fa fa-square fa-stack-2x"></i>
              <i class="fa fa-comments fa-stack-1x fa-inverse"></i>
            </span>
          </a>
        </button>
        {% else %}
        <button type="button" class="lightbtn" id="link-post-icon">
          <a href="{{post.link}}" rel="noreferrer noopener">
            <span class="fa-stack fa-3x" style="color: #616161;">
              <i class="fa fa-square fa-stack-2x"></i>
              {% if post.isImage %}
              <i class="fa fa-image fa-stack-1x fa-inverse"></i>
              {% elif post.getDomain == "youtube.com" %}
              <i class="fa fa-youtube fa-stack-1x fa-inverse"></i>
              {% elif post.getDomain == "vimeo.com" %}
              <i class="fa fa-vimeo fa-stack-1x fa-inverse"></i>
              {% else %}
              <i class="fa fa-link fa-stack-1x fa-inverse"></i>
              {% endif %}
            </span>
          </a>
        </button>
        {% endif %}
      </div>
      <div class="main">
        {% if not post.link %}
        <a class="title" href="{{url_for('view_post', sub=post.sub.name, pid=post.pid)}}">{{post.title}}</a>
        {% else %}
        {% if post.link.startswith('http:') %}<span><i title="not https" class="fa fa-exclamation-circle orange"></i></span>{% endif %}
        <a class="title" href="{{post.link}}" rel="noreferrer noopener">{{post.title}}</a>
        {% endif %}
        <p class="author"><relative-time datetime="{{post.posted.isoformat()}}"></relative-time></p>
        <p class="container">
          {% if post.getDomain == "youtube.com" %}
            <span id="youtubevid" data-vid="{{post.link}}" data-pid="{{post.pid}}" class="closedvid">
              <span id="player{{post.pid}}"><a class="btn small"><i class="fa fa-youtube-play" aria-hidden="true"></i></a></span>
            </span>
          {% endif %}
          {% if post.getDomain == "vimeo.com" %}
            <span id="vimeovid" data-vid="{{post.link}}" data-pid="{{post.pid}}" class="closedvid">
              <span id="player{{post.pid}}"><a class="btn small"><i class="fa fa-vimeo" aria-hidden="true"></i></a></span>
            </span>
          {% endif %}
          {% if post.isImage %}
            <span id="openimg" data-img="{{post.link}}" data-pid="{{post.pid}}" class="closedimg">
              <span id="player{{post.pid}}"><a class="btn small"><i class="fa fa-image" aria-hidden="true"></i></a></span>
            </span>
          {% endif %}
          {% if not post.link %}
            <span id="opentextpost" data-pid="{{post.pid}}" class="closedtextpost">
              <span id="player{{post.pid}}"><a class="btn small"><i class="fa fa-comments" aria-hidden="true"></i></a></span>
            </span>
          {% endif %}
          <a href="{{url_for('view_sub', sub=post.sub.name)}}" class="btn small"><i class="fa fa-users" aria-hidden="true"></i> /s/{{post.sub.name}}</a>
          <a href="{{url_for('view_user', user=post.user.name)}}" class="btn small"><i class="fa fa-user" aria-hidden="true"></i> {{post.user.name}}</a>
          <a href="{{url_for('view_post', sub=post.sub.name, pid=post.pid)}}#comments" class="btn small"><i class="fa fa-comment" aria-hidden="true"></i> Comments ({{post.comments.count()}})</a>
          </p>
      </div>
    </article>
{% endfor %}

{% if sort_type == 'all_new' %}
{% if page > 1 %}
<a href="{{url_for('all_new', page=(page-1))}}" class="btn"><i class="fa fa-chevron-left" aria-hidden="true"></i> prev</a>
{% endif %}
{% if posts|length == 25 %}
<a href="{{url_for('all_new', page=(page+1))}}" class="btn">next <i class="fa fa-chevron-right" aria-hidden="true"></i></a>
{% endif %}
{% endif %}

{% if sort_type == 'all_top' %}
{% if page > 1 %}
<a href="{{url_for('all_top', page=(page-1))}}" class="btn"><i class="fa fa-chevron-left" aria-hidden="true"></i> prev</a>
{% endif %}
{% if posts|length == 25 %}
<a href="{{url_for('all_top', page=(page+1))}}" class="btn">next <i class="fa fa-chevron-right" aria-hidden="true"></i></a>
{% endif %}
{% endif %}

{% endblock %}
{%block pagefoot%}
<!-- create sub form -->
<form id="csub-form" class="mfp-hide white-popup-block">
  {{ csubform.csrf_token }}
  <h1>Create sub</h1>
  <p>Create a sub. For you, for your friends or your favorite community</p>
  <p>{{csubform.subname(placeholder=csubform.subname.label.text, required=True, autofocus=True, pattern="[a-zA-Z0-9_-]+", title="Alphanumeric characters plus '-' and '_'")}}</p>
  <p>{{csubform.title(placeholder=csubform.title.label.text, required=True)}}</p>
  <div class="alert div-error">
    <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
    <p></p>
  </div>
  <p><button type="submit" id="csub-btnsubmit">Create sub</button></p>
</form>
{%endblock%}
