{% extends "layout.html" %}
{% block title %}{{post.title}} | Throat: Open discussion{% endblock %}

{% block navbar %}
<ul class="right">
  <li class="large"><a href="{{url_for('view_sub', sub=post.sub.name)}}">/s/{{post.sub.name}}</a></li>
</ul>
{% endblock %}

{% block main %}
    <main class="col-8 right">
        <article class="text-post center no-padding">
          <div class="head">
            <h1 class="title">{{post.title}}</h1>
            <div class="info">
            {% if post.ptype == 1 %}
              <p class="modpost"><i class="fa fa-user fa-2x" aria-hidden="true"></i> Mod post</p>
            {% endif %}
              <a href="{{url_for('view_user', user=post.user.name)}}" class="btn small"><i class="fa fa-user" aria-hidden="true"></i> {{post.user.name}}</a>
              <span class="time btn small">
                <i class="fa fa-clock-o" aria-hidden="true"></i> Posted <time-ago datetime="{{post.posted.isoformat()}}"></time-ago>
              </span>
            {% if post.edited == true %}
              <span class="time btn small">
                <i class="fa fa-clock-o" aria-hidden="true"></i> Last edited <time-ago datetime="{{post.posted.isoformat()}}"></time-ago>
              </span>
            {% endif %}
            </div>
          </div>
          <div class="content">{{markdown(post.content)|safe}}</div>
        </article>
        {%if current_user.is_authenticated %}
        <section id="postcomment">
          <form class="comment-form">
            {{commentform.csrf_token}}
            {{commentform.sub(value=post.sub.name)}}
            {{commentform.post(value=post.pid)}}
            {{commentform.parent(value='0')}}
            <div class="CommentContent">{{commentform.comment(placeholder="Write your comment here. Styling with Markdown format is supported.")}}</div>
            <button type="submit" class="btn btn-blue">Submit comment</button>
          </form>
          <form class="comment-form moving" style="display:none">
            <div class="close">Ã—</div>
            {{commentform.csrf_token}}
            {{commentform.sub(value=post.sub.name)}}
            {{commentform.post(value=post.pid)}}
            {{commentform.parent(value='0')}}
            <div class="CommentContent">{{commentform.comment(class="commenttxtbox",placeholder="Write your comment here. Styling with Markdown format is supported.")}}</div>
            <button type="submit" class="btn btn-blue">Submit comment</button>
          </form>
        </section>
        {%endif%}
        <section id="comments">
          <h1>Comments</h1>
          {% for comment in post.comments recursive %}
            {% if (loop.depth == 1 and not comment.parentcid) or loop.depth >1 %}
            <article data-cid="{{comment.cid}}" class="text-post center no-padding comment sub-{{loop.depth0}}">
              <div class="head">
                <div class="info">
                {# if post.ptype == 1 %}
                  <p class="modpost"><i class="fa fa-user fa-2x" aria-hidden="true"></i> Mod post</p>
                {% endif #}
                  <a href="{{url_for('view_user', user=comment.user.name)}}" class="btn small"><i class="fa fa-user" aria-hidden="true"></i> {{comment.user.name}}</a>
                  <span class="time btn small">
                    <i class="fa fa-clock-o" aria-hidden="true"></i> Posted <time-ago datetime="{{comment.time.isoformat()}}"></time-ago>
                  </span>
                {# if post.edited == true
                  <span class="time btn small">
                    <i class="fa fa-clock-o" aria-hidden="true"></i> Last edited <time-ago datetime="{{comment.time.isoformat()}}"></time-ago>
                  </span>
                {% endif #}
                </div>
              </div>
              <div class="content">{{markdown(comment.content)|safe}}</div>
              {%if current_user.is_authenticated%}
              <span class="bottombar btn small">
                <a href="#reply" class="lnkreply" data-to="{{comment.cid}}">
                  <i class="fa fa-reply" aria-hidden="true"></i> reply
                </a>
              </span>
              {%endif%}
            </article>
            {% if comment.children %}
              {{loop(comment.children)}}
            {%endif%}
            {%endif%}
          {%endfor%}
        </section>
    </main>
{% endblock %}
{%block pagefoot%}
{%if current_user.is_authenticated%}
<script type="text/javascript" src="{{ url_for('static', filename='js/simplemde.min.js') }}"></script>
<script>
  var simplemde = new SimpleMDE({autoDownloadFontAwesome: false, spellChecker: false, autosave: {enabled: true, unique_id: "createcomment",}});
</script>
{%endif%}
{%endblock%}
