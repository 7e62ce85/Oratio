{% extends "layout.html" %}
{% block title %}{{sub.title}} | {{config.LEMA}}{% endblock %}


{% block sidebar %}
<div id="sortbuttons">
  <a href="{{url_for('view_sub_hot', sub=sub.name)}}" class="sbm-post pure-button pure-button{% if request.endpoint in ('view_sub', 'view_sub_hot') %}-primary{%endif%} pure-u-md-6-24">Hot</a>
  <a href="{{url_for('view_sub_new', sub=sub.name)}}" class="sbm-post pure-button pure-button{% if request.endpoint == 'view_sub_new' %}-primary{%endif%} pure-u-md-6-24">New</a>
  <a href="{{url_for('view_sub_top', sub=sub.name)}}" class="sbm-post pure-button pure-button{% if request.endpoint == 'view_sub_top' %}-primary{%endif%} pure-u-md-6-24">Top</a>
</div>
<form class="pure-g search" action="{{ url_for('do.title_search') }}" method="post">
  <div class="icon" data-icon="search"> </div>
  <input name="term" placeholder="Title search..." type="search" class="pure-u-1">
</form>

{% if func.enableVideoMode(sub) %}
  <div class="musicmodediv">
    {% include 'videomodeplayer.html' %}
  </div>
<hr>
{% endif %}
{% if current_user.is_authenticated %}
  {% if func.isRestricted(sub) and not current_user.is_mod(sub) %}
    <div>Only mods can post.</div>
  {%else%}
    {%if current_user.is_subban(sub) %}
      <div>You are currently banned from posting.</div>
    {%else%}
      <a href="{{url_for('submit_text', sub=sub.name)}}" class="sbm-post pure-button">Submit a text post</a>
      <a href="{{url_for('submit_link', sub=sub.name)}}" class="sbm-post pure-button">Submit a link post</a>
    {%endif%}
  {%endif%}
{%endif%}

<div class="subinfo">
  <h3>/s/{{sub.name}} {% if sub.nsfw %}<div class="nsfw" alt="Not safe for work">NSFW</div>{%endif%}</h3>
</div>
<div class="subs">{{getSuscriberCount(sub)}} subscribers</div>

<div role="group" class="pure-button-group">
  {% if current_user.has_subscribed(sub.sid) %}
    <button class="button-secondary pure-button button-xsmall pure-button-active"><span class="sbm-icon" data-icon="check"></span>Subscribed</button>
  {%else%}
    <button class="button-secondary pure-button button-xsmall"><span class="sbm-icon" data-icon="add"></span>Subscribe</button>
  {%endif%}
  {% if current_user.has_blocked(sub.sid) %}
    <button class="button-warning pure-button button-xsmal pure-button-activel"><span class="sbm-icon" data-icon="check"></span>Blocked</button>
  {%else%}
    <button class="button-warning pure-button button-xsmall"><span class="sbm-icon" data-icon="close"></span>Block</button>
  {%endif%}
</div>
<hr>
{%if sub.sidebar != ''%}
  {{markdown(sub.sidebar)|safe}}
  <hr>
{%endif%}

<div class="createdby">
  Created by {{func.getSubUsers(func.getSub(sub.sid), 'mod')}}
  <time-ago datetime="{{func.getSubCreation(sub)}}Z"></time-ago>
</div>
<div class="moderators">
  Moderators
  <ul>
  <li><span title="Owner" class="i-icon" data-icon="owner"></span> <a href="{{url_for('view_user', user=func.getSubUsers(sub, 'mod1'))}}">{{func.getSubUsers(sub, 'mod1')}}</a></li>
  {% for mod in mods %}
  <li><a href="{{url_for('view_user', user=db.get_user_from_uid(mod.value).name)}}">{{db.get_user_from_uid(mod.value).name}}</a></li>
  {% endfor %}
  </ul>
</div>

{% if current_user.is_mod(sub) or current_user.is_admin() %}
  <a href="{{url_for('edit_sub', sub=sub.name)}}" class="sbm-post pure-button">Edit Sub Info</a>
  <a href="{{url_for('edit_sub_flairs', sub=sub.name)}}" class="sbm-post pure-button">Edit Sub Flairs</a>
  <a href="{{url_for('edit_sub_css', sub=sub.name)}}" class="sbm-post pure-button">Edit Sub Stylesheet</a>
  <a href="{{url_for('edit_sub_mods', sub=sub.name)}}" class="sbm-post pure-button">Moderators</a>
{% endif %}
<hr>

<a href="{{url_for('view_sublog', sub=sub.name)}}" class="sbm-post pure-button">Sub Log</a>
<a href="{{url_for('view_sub_bans', sub=sub.name)}}" class="sbm-post pure-button">Banned Users</a>
{% endblock %}

{% block content %}
{{ super() }}
{% cache 300, 'sticky', sub.sid %}
  {% set sticks = func.getStickies(sub.sid) %}
  {% for post in sticks %}
    {% include "indexpost.html" %}
  {%endfor%}
{% endcache %}
{% if not posts %}<h1 class="noshit">There are no posts here, yet.</h1>{% endif %}
{# cache 120, 'subposts', sub.sid, sort_type, page|string #}
  {% for post in posts if not db.is_post_deleted(post) and not post in func.getStickies(sub.sid)%}
    {% include "indexpost.html" %}
  {% endfor %}
{# endcache #}
{% if page > 1 %}
<a href="{{url_for(sort_type, sub=sub.name, page=(page-1))}}" class="btn"><i class="fa fa-chevron-left" aria-hidden="true"></i> prev</a>
{% endif %}
{% if posts|length == 20 %}
<a href="{{url_for(sort_type, sub=sub.name, page=(page+1))}}" class="btn">next <i class="fa fa-chevron-right" aria-hidden="true"></i></a>
{% endif %}

{% endblock %}
{%block pagefoot%}
{% if not current_user.block_styles() %}
  <style>{{db.get_sub_stylesheet(sub.sid)|safe}}</style>
{% endif %}
{%endblock%}
