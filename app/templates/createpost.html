{% extends "layout.html" %}
{% block head %}
{{ super() }}
{% if func.get_user_level(current_user.uid)[0] <= 4 %}
 <script src="https://www.google.com/recaptcha/api.js?onload=recaptchaCallback&render=explicit" type="text/javascript"></script>
<script>
var recaptchaCallback = function(){
    grecaptcha.render($('.g-recaptcha')[0], {sitekey: "{{config.RECAPTCHA_PUBLIC_KEY}}"});
}
</script>
{%endif%}
{% endblock %}
{% block content %}
{{ super() }}
{% if type == "text" %}
  <form  method="POST" id="post-form" action="{{url_for('do.create_txtpost')}}" data-redir="true" class="ajaxform">
    {% set txtpostform = form.CreateSubTextPost()%}
    {{txtpostform.csrf_token}}
    <h1>Submit a text post</h1>
    <div class="pull right"><a href="{{url_for('submit_link', sub=sub)}}">Submit a link post</a></div>
    <p class="sub">
      /s/<input name="sub" type="text" id="sub" list="subdatalist" value="{{sub}}" required>
      <datalist id="subdatalist">
        {% for subname in subs %}
        <option value="{{subname}}">
        {% endfor %}
      </datalist>
    </p>
    <p class="title">{{txtpostform.title(placeholder=txtpostform.title.label.text, required=True)}}</p>
    <p><label>{{txtpostform.nsfw.label.text}} {{txtpostform.nsfw()}}</label></p>
    <p>{{txtpostform.content(placeholder="(Optional) Write your post content here. Styling with Markdown format is supported.", rows="10", **{'data-provide' :"markdown"})}}</p>
    {% if func.get_user_level(current_user.uid)[0] <= 4 %}
      <div class="g-recaptcha"></div>
    {% endif %}
    <div class="alert div-error">
      <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
      <p></p>
    </div>
    <p><button type="submit" class="btn btn-blue" data-prog="Sending...">Submit post</button></p>
  </form>
{% else %}
  <form  method="POST" id="link-post-form" action="{{url_for('do.create_lnkpost')}}" data-redir="true" class="ajaxform">
    {% set lnkpostform = form.CreateSubLinkPost()%}
    {{lnkpostform.csrf_token}}
    <h1>Submit a link post</h1>
    <div class="pull right"><a href="{{url_for('submit_text', sub=sub)}}">Submit a text post</a></div>
    <p class="sub">
      /s/<input name="sub" type="text" id="sub" list="subdatalist" value="{{sub}}" required>
      <datalist id="subdatalist">
        {% for subname in subs %}
        <option value="{{subname}}">
        {% endfor %}
      </datalist>
    </p>    <p class="title">{{lnkpostform.title(placeholder="Title", required=True)}}</p>
    <div class="row">
      <div class="col-10 link" style="padding:0;">{{lnkpostform.link(type="url", pattern="https?://.+", required=True, placeholder="URL")}}</div>
      <a class="col-2 btn btn-blue" id="graburl">Grab title</a>
    </div>
    <p><label>{{lnkpostform.nsfw.label.text}} {{lnkpostform.nsfw()}}</label></p>
      {% if func.get_user_level(current_user.uid)[0] <= 4 %}
        <div class="g-recaptcha"></div>
      {% endif %}
      <div class="alert div-error">
      <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
      <p></p>
    </div>
    <p><button type="submit" class="btn btn-blue" data-prog="Sending...">Submit link</button></p>
  </form>
{% endif %}
{%endblock%}
