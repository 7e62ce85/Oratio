{% extends "layout.html" %}
{% block head %}
{{ super() }}
{% if func.get_user_level(current_user.uid)[0] <= 4 %}
 <script src="https://www.google.com/recaptcha/api.js?onload=recaptchaCallback&render=explicit" type="text/javascript"></script>
<script>
var recaptchaCallback = function(){
    grecaptcha.render(document.getElementById('gcaptcha'), {sitekey: "{{config.RECAPTCHA_PUBLIC_KEY}}"});
}
</script>
{%endif%}
{% endblock %}
{% block sidebar %}
<div id="sortbuttons" role="group" class="pure-button-group">
  <div class="pure-g">
    <button class="pure-button" id="ptoggle">Change to {%if txtpostform.ptype.data=="text"%}link{%else%}text post{%endif%}</button>
  </div>
</div>
{% endblock %}
{% block content %}
{{ super() }}
<div id="center-container">
  <div class="content createpost">
      <form  method="POST" id="post-form" action="{{url_for('do.create_post')}}" data-redir="true" class="pure-form pure-form-aligned" enctype="multipart/form-data">
        {% set subs = db.get_all_sub_names()%}
        <input type="hidden" id="ptypeval" name="ptype" value="{{txtpostform.ptype.data}}">
        {{txtpostform.csrf_token}}
        <h1>Submit a <span id="ptype">{{txtpostform.ptype.data}}</span> post</h1>
        <fieldset>
          <div class="pure-control-group">
            <span class="sub">
              <label for="sub">Sub</label>
              {{txtpostform.sub(list="subdatalist", required=True)}}
              <datalist id="subdatalist">
                {% for subname in subs %}
                  <option value="{{subname}}">
                {% endfor %}
              </datalist>
            </span>
          </div>
          <div class="pure-control-group">
            <label for="title">Title</label>
            {{txtpostform.title(placeholder=txtpostform.title.label.text, required=True)}}
          </div>

            <div class="pure-control-group" id="txcont" {% if txtpostform.ptype.data!="text" %}style="display:none"{%endif%}>
              <label for="content">Content</label>
              <div class="markdown-editor">
                {{txtpostform.content(class="exalert", placeholder="(Optional) Write your post content here. Styling with Markdown format is supported.", rows="10", style="width: 100%")}}
              </div>
            </div>
            <div class="pure-control-group lncont pure-u-sm-20-24" {% if txtpostform.ptype.data!="link" %}style="display:none"{%endif%}>
            {% if current_user.canupload %}You can either upload an image or post a link{% endif %}
            </div>
            <div class="pure-control-group lncont pure-u-sm-20-24" {% if txtpostform.ptype.data!="link" %}style="display:none"{%endif%}>
              <label for="link">Link</label>
              {{txtpostform.link(type="url", pattern="https?://.+", required=True if txtpostform.ptype.data=="link" and not current_user.canupload else False, placeholder="URL")}}
            </div>
            <div class="pure-control-group pure-u-sm-3-24 lncont" {% if txtpostform.ptype.data!="link" %}style="display:none"{%endif%}>
              <button id="graburl" class="pure-button">Grab title</button>
            </div>
            {% if current_user.canupload %}
            <div class="pure-control-group lncont pure-u-sm-20-24" {% if txtpostform.ptype.data!="link" %}style="display:none"{%endif%}>
              <label for="files">File</label>
              <input type="file" name="files" placeholder="Only images allowed" />
            </div>
            {% endif %}


          <div class="pure-control-group">
            <label>{{txtpostform.nsfw.label.text}}</label>
            {{txtpostform.nsfw()}}
          </div>
          {% if func.get_user_level(current_user.uid)[0] <= 4 %}
            <div class="pure-control-group">
              <div id="gcaptcha" class="g-recaptcha"></div>
            </div>
          {% endif %}
          <div class="pure-controls">
            {% if error %}
              <div class="error">{{error}}</div>
            {% endif %}
            <button onclick="window.sending=true;" type="submit" class="pure-button pure-button-primary">Submit post</button>
          </div>
        </fieldset>
      </form>
  </div>
</div>
{% endblock %}
