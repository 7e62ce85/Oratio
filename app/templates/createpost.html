{% extends "layout.html" %}
{% block head %}
{{ super() }}
{% if func.get_user_level(current_user.uid)[0] <= 4 %}
 <script src="https://www.google.com/recaptcha/api.js?onload=recaptchaCallback&render=explicit" type="text/javascript"></script>
<script>
var recaptchaCallback = function(){
    grecaptcha.render($('.g-recaptcha')[0], {sitekey: "{{config.RECAPTCHA_PUBLIC_KEY}}"});
}
</script>
{%endif%}
{% endblock %}
{% block sidebar %}
<div id="sortbuttons" role="group" class="pure-button-group">
  <div class="pure-g">
    {% if type == "text" %}
      <a href="{{url_for('submit_link', sub=sub)}}" class="pure-button">Change to link post</a>
    {% else %}
      <a href="{{url_for('submit_text', sub=sub)}}" class="pure-button">Change to text post</a>
    {% endif %}
  </div>
</div>
{% endblock %}
{% block content %}
{{ super() }}
<div id="center-container">
  <div class="content createpost">
    {% if type == "text" %}
      <form  method="POST" id="post-form" action="{{url_for('do.create_txtpost')}}" data-redir="true" class="pure-form pure-form-aligned">
        {% set txtpostform = form.CreateSubTextPost()%}
        {{txtpostform.csrf_token}}
        <h1>Submit a text post</h1>
        <fieldset>
          <div class="pure-control-group">
            <span class="sub">
              <label for="sub">Sub</label>
              <input name="sub" type="text" id="sub" list="subdatalist" value="{{sub}}" required>
              <datalist id="subdatalist">
                {% for subname in subs %}
                  <option value="{{subname}}">
                {% endfor %}
              </datalist>
            </span>
          </div>
          <div class="pure-control-group">
            <label for="title">Title</label>
            {{txtpostform.title(placeholder=txtpostform.title.label.text, required=True)}}
          </div>
          <div class="pure-control-group">
            <label for="content">Content</label>
            {{txtpostform.content(placeholder="(Optional) Write your post content here. Styling with Markdown format is supported.", rows="10", **{'data-provide' :"markdown"})}}
          </div>
          <div class="pure-control-group">
            <label>{{txtpostform.nsfw.label.text}}</label>
            {{txtpostform.nsfw()}}
          </div>
          {% if func.get_user_level(current_user.uid)[0] <= 4 %}
            <div class="pure-control-group">
              <div class="g-recaptcha"></div>
            </div>
          {% endif %}
          <div class="pure-controls">
            {% if error %}
              <div class="error">{{error}}</div>
            {% endif %}
            <button type="submit" class="pure-button pure-button-primary">Submit post</button>
          </div>
        </fieldset>
      </form>
    {% else %}
      <form  method="POST" id="link-post-form" action="{{url_for('do.create_lnkpost')}}" data-redir="true" class="pure-form pure-form-aligned ajaxform">
        {{lnkpostform.csrf_token}}
        <h1>Submit a link post</h1>
        <fieldset>
          <div class="pure-control-group">
            <span class="sub">
              <label for="sub">Sub</label>
              <input name="sub" type="text" id="sub" list="subdatalist" value="{{sub}}" required>
              <datalist id="subdatalist">
                {% for subname in subs %}
                  <option value="{{subname}}">
                {% endfor %}
              </datalist>
            </span>
          </div>
          <div class="pure-control-group">
            <label for="title">Title</label>
            {{lnkpostform.title(placeholder="Post title", required=True)}}
          </div>
          <div class="pure-control-group">
            <label for="link">Link</label>
            <span name="link" style="padding:0;">{{lnkpostform.link(type="url", pattern="https?://.+", required=True, placeholder="URL")}}</span>
          </div>
          <div class="pure-control-group">
            <label for="graburl"></label>
            <a class="pure-button" id="graburl">Grab title</a>
          </div>
          <div class="pure-control-group">
            <label>{{lnkpostform.nsfw.label.text}}</label>
            {{lnkpostform.nsfw()}}
          </div>
          {% if func.get_user_level(current_user.uid)[0] <= 4 %}
            <div class="pure-control-group">
              <div class="g-recaptcha"></div>
            </div>
          {% endif %}
          <div class="pure-controls">
            {% if error %}
              <div class="error">{{error}}</div>
            {% endif %}
            <button type="submit" class="pure-button pure-button-primary">Submit link</button>
          </div>
        </fieldset>
      </form>
    {% endif %}
  </div>
</div>
{% endblock %}
