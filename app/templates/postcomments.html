{% for comment in comments recursive %}
  {%if comment.cid != None %}
    <article id="{{comment.cid}}" data-cid="{{comment.cid}}" class="{% if comment.hl %}active{%endif%} text-post no-padding comment sub-{{loop.depth0}}">
      <div class="commentrow {%if comment.cid == highlight %}highlight{%endif%}" id="comment-{{comment.cid}}">
        <div class="pull left votecomment" {% if comment.status == 1 %}style="display:none;"{%endif%}>
          {# vote arrow div #}
          {% if comment.userstatus != 10 %}
            <div title="Upvote" class="c-upvote{%if comment.positive == True %} upvoted{%endif%}" data-pid="{{post.pid}}" data-icon="upvote"></div>
            <div title="Downvote" class="c-downvote{%if comment.positive == False %} downvoted{%endif%}" data-pid="{{post.pid}}" data-icon="downvote"></div>
          {%endif%}
        </div>
        <div class="commblock">
          <div class="commenthead">
              <a class="togglecomment {% if comment.status == 1 %}expand{%else%}collapse{%endif%}" data-cid="{{comment.cid}}">
                {% if comment.status == 1 %}[+]{%else%}[â€“]{%endif%}
              </a>
              {% if not comment.status == 1 %}
                {% if comment.userstatus == 10 %}
                <a class="poster deleted">[Deleted]</a>
                {%else%}
                <a href="{{ url_for('view_user', user=comment.user) }}" class="poster">
                  {% if comment.userstatus == 100 %}<span class="bot-tag">bot</span>{%endif%}
                  {{ comment.user }}
                  {% if post.user == comment.user %}<span class="OPtag">[OP]</span>{%endif%}
                </a>
                {%endif%}
              {%else%}
                <a class="poster deleted">[Deleted]</a>
              {%endif%}
              <b><span class="cscore">{{comment.score}}</span> points</b> (+<b>{{comment.upvotes}}</b>|-<b>{{comment.downvotes}}</b>)
              <span class="time ">
                 <time-ago datetime="{{comment.time.isoformat()}}Z"></time-ago>
              </span>
            {% if comment.lastedit and not comment.status == 1 %}
              <span class="time edited">
                Edited <time-ago datetime="{{comment.lastedit.isoformat()}}Z"></time-ago>
              </span>
            {% endif %}
          </div>
          <div class="content" id="content-{{comment.cid}}" {% if comment.status == 1 %}style="display:none;"{%endif%}>
            {% if comment.status == 1 %}[Deleted]{%else%}
              {{comment.content|safe}}
            {%endif%}
          </div>
          {%if not comment.status == 1 %}
            <div hidden id="sauce-{{comment.cid}}">{{comment.source}}</div>
          {%endif%}
          <ul class="bottombar links" {% if comment.status == 1 %}style="display:none;"{%endif%}>
            <li><a href="{{url_for('sub.view_perm', sub=sub.name, cid=comment.cid, pid=post.pid)}}">permalink</a></li>
            {%if current_user.is_authenticated and not post.deleted %}
              <li><a class="reply-comment" data-pid="{{comment.pid}}" data-to="{{comment.cid}}">reply</a></li>
              {% if comment.uid == current_user.uid and not comment.status == 1 %}
                <li><a class="edit-comment" data-cid="{{comment.cid}}">edit</a></li>
              {% endif %}
              {% if (comment.uid == current_user.uid or current_user.is_admin() or current_user.is_mod(sub.sid)) and not comment.status == 1 %}
                <li><a {% if comment.uid == current_user.uid %}selfdel="true"{%endif%} class="delete-comment" data-cid="{{comment.cid}}">delete</a></li>
              {% endif %}
              <a data-ac="report" cid="{{comment.cid}}" class="report-comment">report</a>
            {%endif%}
            {%if comment.status != 1 %}<li><a class="comment-source" data-cid="{{comment.cid}}">source</a></li>{%endif%}
          </ul>
        </div>
      </div>
      <div id="child-{{comment.cid}}" class="pchild{% if comment['morechildren'] %}-e{% endif %}" {% if comment.status == 1 %}style="display:none;"{%endif%}>
        {% if comment['morechildren'] %}
        <a href="#" class="loadchildren" data-pid="{{post.pid}}" data-cid="{{comment.cid}}">Load more ({{comment.morechildren}} comments)</a>
        {% elif comment['children'] %}
          {{loop(comment['children'] )}}
        {% endif %}
      </div>
    </article>
  {%endif%}
  {% if comment['cid'] == None %}
    <a href="#" class="loadsibling" data-pid="{{post.pid}}" data-key="{{comment.key}}" data-pcid="{{comment.pcid}}">Load more ({{comment.more}} comment{%if comment.more > 1%}s{%endif%})</a>
  {% endif %}

{%endfor%}
