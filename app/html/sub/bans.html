@extends("shared/layout.html")
@require(sub, banned, xbans, banuserform)
@def main():
<div id="container">

@if not current_user.is_mod(sub.sid, 1) and current_user.is_admin():
<h3>Editing as Admin</h3>
@end

<h2>Banned users for <a href="@{url_for('sub.view_sub', sub=sub.name)}">@{conf['SUB_PREFIX']}/@{sub.name}</a></h2>
@if current_user.is_admin() or current_user.is_mod(sub.sid, 1):
<h3>Ban user</h3>
<div class="editmoderators">
  <form id="ban-user-form" data-reload="true" data-sub="@{sub.name}" class="ajaxform pure-form" action="@{url_for('do.ban_user_sub', sub=sub.name)}">
    @{banuserform.csrf_token()}
    <p>
      <label>@{banuserform.user(placeholder=banuserform.user.label.text, required=True)}</label>
      @{banuserform.reason(placeholder=banuserform.reason.label.text, required=True)}
      <select id="ban_timepick">
        <option value="ban_perm">Forever</option>
        <option value="ban_temp">Until...</option>
      </select>
      <input id="ban_expires" name="ban_expires" type="text" class="date-picker-future" style="display: none;" placeholder="Pick date">
      <input type="hidden" id="ban_expires_data" name="expires" value=""/>
      <button type="submit" class="pure-button pure-button-primary" id="banuser-btnsubmit">Banhammer</button>
    </p>
    <div class="alert div-error">
      <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span>
      <p></p>
    </div>
  </form>
</div>
<hr/>
@end

<div class="col-12">
  <h3>Banned users</h3>
  @if banned.count() < 1:
    none
  @else:
    <table>
      <thead>
        <tr>
          <th>By</th>
          <th>Created</th>
          <th>User</th>
          <th>Reason</th>
          <th>Expires</th>
          @if current_user.is_admin() or current_user.is_mod(sub.sid, 1):
          <th>Actions</th>\
          @end
        </tr>
      </thead>
      <tbody>
        @for ban in banned:
        <tr>
          <td>
            @if ban.created_by_id:
            <a href="@{url_for('view_user', user=ban.created_by.name)}">@{ban.created_by.name}</a> \
            @else:
              N/A \
            @end
          </td>
          <td>
          @if ban.created:
            <time-ago datetime="@{ban.created.isoformat()}Z">@{ban.created.isoformat()}</time-ago>\
          @else:
            N/A\
          @end
          </td>
          <td><a href="@{url_for('view_user', user=ban.user.name)}">@{ban.user.name}</a></td>
          <td>@{ban.reason!!e}</td>
          <td>
            @if ban.expires:
              <time-until datetime="@{ban.expires.isoformat()}Z">@{ban.expires.isoformat()}</time-until>\
            @else:
            Never\
            @end
          </td>
          @if current_user.is_admin() or current_user.is_mod(sub.sid, 1):
          <td><a data-sub="@{sub.name}" data-user="@{ban.user.name}" class="slink revoke-ban">unban</a></td>
          @end
        </tr>
        @end
      </tbody>
    </table>
  @end
</div>
<hr>
<div class="col-12">
  <h3>Past bans</h3>
  @if xbans.count() < 1:
    none\
  @else:
  <table>
    <thead>
      <tr>
        <th>By</th>
        <th>Created</th>
        <th>User</th>
        <th>Reason</th>
        <th>Removed</th>
      </tr>
    </thead>
    <tbody>
      @for ban in xbans:
      <tr>
        <td>
        @if ban.created_by_id:
          <a href="@{url_for('view_user', user=ban.created_by.name)}">@{ban.created_by.name}</a>
        @else:
          N/A \
        @end
        </td>
        <td>
        @if ban.created:
          <time-ago datetime="@{ban.created.isoformat()}Z">@{ban.created.isoformat()}</time-ago>\
        @else:
          N/A\
        @end
        </td>
        <td><a href="@{url_for('view_user', user=ban.user.name)}">@{ban.user.name}</a></td>
        <td>@{ban.reason!!e}</td>
        <td>
        @if ban.expires:
          <time-ago datetime="@{ban.expires.isoformat()}Z">@{ban.expires.isoformat()}</time-ago> \
        @else:
          N/A \
        @end
        </td>
      </tr>
      @end
    </tbody>
  </table>
  @end
  </ul>
</div>
</div>
@end